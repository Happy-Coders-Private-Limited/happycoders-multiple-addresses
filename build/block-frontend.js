(()=>{"use strict";var e,s={433:(e,s,t)=>{const o=window.wp.element,n=window.wp.i18n,r=window.wp.data,a=window.wp.components,c=window.wp.apiFetch;var d=t.n(c);const l=window.ReactJSXRuntime,i=window.hc_wcma_block_params||{},p=i.i18n||{},m=(e,s)=>{const t={billing:["first_name","last_name","address_1","city","postcode","country"],shipping:["first_name","last_name","address_1","city","postcode","country"]};"billing"===s&&t.billing.push("email"),"1"===i.phone_required&&t[s].push("phone"),"1"===i.company_required&&t[s].push("company"),"1"===i.address_2_required&&t[s].push("address_2");const o=[],r={first_name:(0,n.__)("First Name","happycoders-multiple-addresses"),last_name:(0,n.__)("Last Name","happycoders-multiple-addresses"),company:(0,n.__)("Company","happycoders-multiple-addresses"),address_1:(0,n.__)("Address Line 1","happycoders-multiple-addresses"),address_2:(0,n.__)("Address Line 2","happycoders-multiple-addresses"),city:(0,n.__)("City","happycoders-multiple-addresses"),postcode:(0,n.__)("Postal Code","happycoders-multiple-addresses"),country:(0,n.__)("Country","happycoders-multiple-addresses"),email:(0,n.__)("Email","happycoders-multiple-addresses"),phone:(0,n.__)("Phone","happycoders-multiple-addresses")};return t[s].forEach((s=>{e[s]&&""!==e[s].trim()||o.push(r[s]||s)})),{isComplete:0===o.length,missingFields:o}},u=({addressType:e="billing"})=>{const s=i.defaultKeys?.[e]||"",[t,c]=(0,o.useState)(s),[u,h]=(0,o.useState)(""),[y,g]=(0,o.useState)(""),[b,k]=(0,o.useState)(!1),[f,w]=(0,o.useState)(!1),[v,x]=(0,o.useState)([]),[S,C]=(0,o.useState)(!1),[j,M]=(0,o.useState)(!1),E=i.addresses||{},O=(0,o.useCallback)(((s,t=[])=>{console.log(`[HCMA ${e}] Validation error state:`,s,t),T(s,t)}),[e]),T=(0,o.useCallback)(((s,t=[])=>{const o=document.querySelector(".wp-block-woocommerce-checkout");if(!o)return;const r=`hc-wcma-global-error-${e}`;let a=document.getElementById(r);if(s&&t.length>0){a||(a=document.createElement("div"),a.id=r,a.className="wc-block-components-notice-banner is-error",a.style.cssText="\n                    background-color: #ffeaea;\n                    border: 1px solid #ff6b6b;\n                    border-radius: 4px;\n                    padding: 16px;\n                    margin: 16px 0;\n                    color: #d32f2f;\n                ",o.insertBefore(a,o.firstChild));const s=(0,n.sprintf)((0,n.__)("Your saved %s address is incomplete. Missing: %s. Please update it or enter a new address.","happycoders-multiple-addresses"),e,t.join(", "));a.innerHTML=`<strong>${s}</strong>`,a.style.display="block"}else a&&(a.style.display="none")}),[e]),$=E[e]||{},N=Object.keys($).length>0?Object.values($):[],q="yes"===i.allow_new,H=i.selector_style||"dropdown",A=i.existing_nicknames||{},F=(0,o.useCallback)((s=>{k(!0);const t={[e+"_address"]:s};return(0,r.dispatch)("wc/store/cart").updateCustomerData(t,!1).then((()=>{k(!1)})).catch((e=>{throw k(!1),e}))}),[r.dispatch,e]),L=(0,o.useCallback)((s=>{if(c(s),k(!0),C(!1),x([]),M(!1),O(!1),T(!1),"new"===s||""===s){const s={first_name:"",last_name:"",company:"",address_1:"",address_2:"",city:"",state:"",postcode:"",country:"",phone:"",nickname:""};"billing"===e&&(s.email=""),F(s).then((()=>{k(!1),_(e,!0)})).catch((()=>{k(!1),_(e,!0)}))}else{const t=E[e]?.[s];if(t){const s=m(t,e);s.isComplete||(console.warn(`[HCMA Block Frontend ${e}] Selected address is incomplete. Missing fields:`,s.missingFields),x(s.missingFields),C(!0),M(!0),O(!0,s.missingFields),k(!1));const o={first_name:t.first_name||"",last_name:t.last_name||"",company:t.company||"",address_1:t.address_1||"",address_2:t.address_2||"",city:t.city||"",state:t.state||"",postcode:t.postcode||"",country:t.country||"",phone:t.phone||"",nickname:t.nickname||""};"billing"===e&&(o.email=t.email||""),s.isComplete&&(C(!1),x([]),M(!1),O(!1),T(!1)),F(o).then((()=>{k(!1),_(e,!1)})).catch((()=>{k(!1),_(e,!0)}))}else _(e,!0),k(!1)}}),[e,E,F]);(0,o.useEffect)((()=>{if(s&&$[s]){c(s);const t=$[s],o=m(t,e);o.isComplete?(x([]),C(!1),M(!1),O(!1)):(x(o.missingFields),C(!0),M(!0),O(!0,o.missingFields));const n={first_name:t.first_name||"",last_name:t.last_name||"",company:t.company||"",address_1:t.address_1||"",address_2:t.address_2||"",city:t.city||"",state:t.state||"",postcode:t.postcode||"",country:t.country||"",phone:t.phone||"",nickname:t.nickname||""};"billing"===e&&(n.email=t.email||""),F(n).then((()=>_(e,!1))).catch((()=>_(e,!0)))}else 0===N.length&&w(!0),c(""),_(e,!0)}),[s,e,$,F]),(0,o.useEffect)((()=>{if("new"===t||f){const s={address_type:e,nickname_type:u,nickname:y};d()({path:"/hc-wcma/v1/save-nickname",method:"POST",headers:{"Content-Type":"application/json"},data:s}).then((e=>{e.success||console.error("Error saving nickname:",e.message)})).catch((e=>{console.error("Error saving nickname:",e)}))}}),[u,y,t,e,f]);const B=[];if(N.forEach((e=>{if(!e.key)return;let t=e.nickname||e.address_1||e.city||e.key;e.key===s&&(t+=` ${p.default_label||"(Default)"}`),B.push({label:t,value:e.key})})),q&&B.push({label:p.new_address||"Enter a new address",value:"new"}),B.length<1&&!f)return null;const P=[{label:p.select_nickname||(0,n.__)("Select Nickname","happycoders-multiple-addresses"),value:""},{label:p.home||(0,n.__)("Home","happycoders-multiple-addresses"),value:"Home",disabled:A[e]?.includes("Home")},{label:p.work||(0,n.__)("Work","happycoders-multiple-addresses"),value:"Work",disabled:A[e]?.includes("Work")},{label:p.other||(0,n.__)("Other","happycoders-multiple-addresses"),value:"Other"}];try{return(0,l.jsxs)("div",{className:`hc-wcma-block-checkout-selector hc-wcma-${e}-selector ${b?"is-loading":""} wp-block-hc-wcma-address-selector`,children:[(0,l.jsxs)("div",{style:{marginBottom:"1em",opacity:b?.5:1,pointerEvents:b?"none":"auto"},children:["list"===H?(0,l.jsx)(a.RadioControl,{selected:t,options:B,onChange:L,className:"hc-wcma-address-radio-list"}):(0,l.jsx)(a.SelectControl,{value:t,options:B,onChange:L,className:"hc-wcma-address-select"}),("new"===t||f)&&(0,l.jsxs)("div",{className:"hc-wcma-nickname-fields",children:[(0,l.jsx)(a.SelectControl,{label:p.address_nickname_type||(0,n.__)("Address Nickname Type","happycoders-multiple-addresses"),value:u,options:P,onChange:e=>h(e)}),"Other"===u&&(0,l.jsx)(a.TextControl,{label:p.custom_nickname||(0,n.__)("Custom Nickname","happycoders-multiple-addresses"),value:y,onChange:e=>g(e)})]})]}),S&&v.length>0&&(0,l.jsxs)("div",{className:"hc-wcma-validation-error",style:{backgroundColor:"#ffeaea",border:"2px solid #ff6b6b",borderRadius:"6px",padding:"16px",marginTop:"16px",marginBottom:"16px",color:"#d32f2f",fontSize:"14px",fontWeight:"normal",boxShadow:"0 2px 4px rgba(255, 107, 107, 0.1)",position:"relative",zIndex:1e3},children:[(0,l.jsx)("p",{style:{margin:"0 0 8px 0",fontWeight:"bold"},children:(0,n.sprintf)((0,n.__)("The selected %s address is incomplete. Please update the address in your account or enter a new address.","happycoders-multiple-addresses"),e)}),(0,l.jsx)("p",{style:{margin:"0 0 8px 0"},children:(0,l.jsx)("strong",{children:(0,n.__)("Missing required fields:","happycoders-multiple-addresses")})}),(0,l.jsx)("ul",{style:{margin:"0",paddingLeft:"20px"},children:v.map(((e,s)=>(0,l.jsx)("li",{children:e},s)))}),(0,l.jsx)("p",{style:{margin:"8px 0 0 0",fontSize:"0.9em"},dangerouslySetInnerHTML:{__html:(0,n.sprintf)((0,n.__)('Please visit your %sAccount page%s to update this address, or select "Enter a new address".',"happycoders-multiple-addresses"),'<a href="'+(i.my_account_url||"/my-account/hc-address-book/")+'" style="color: #1976d2;">',"</a>")}})]}),b&&(0,l.jsx)("p",{className:"hc-wcma-loading-text",children:p.loading||"Loading..."})]})}catch(e){return(0,l.jsx)("p",{style:{color:"red",border:"1px solid red",padding:"5px"},children:"Error rendering HCMA selector!"})}};function h(){const e=i.addresses||{},s=e.billing&&Object.keys(e.billing).length>0,t=e.shipping&&Object.keys(e.shipping).length>0,n="yes"===i.allow_new;if(s||n){const e=document.querySelector(".wp-block-woocommerce-checkout-billing-address-block .wc-block-components-checkout-step__content");if(e){const s=document.createElement("div");if(s.className="hc-wcma-billing-mount-point",e.prepend(s),!s.dataset.reactMounted)try{(0,o.render)((0,l.jsx)(u,{addressType:"billing"}),s),s.dataset.reactMounted="true"}catch(e){console.error("[HCMA Blocks Frontend] Error mounting billing component:",e)}}}else console.log("[HCMA Blocks Frontend] Skipping Billing selector - no addresses and new not allowed.");if(t||n){const e=document.querySelector(".wp-block-woocommerce-checkout-shipping-address-block .wc-block-components-checkout-step__content");if(e){const s=document.createElement("div");if(s.className="hc-wcma-shipping-mount-point",e.prepend(s),!s.dataset.reactMounted)try{(0,o.render)((0,l.jsx)(u,{addressType:"shipping"}),s),s.dataset.reactMounted="true"}catch(e){console.error("[HCMA Blocks Frontend] Error mounting shipping component:",e)}}}else console.log("[HCMA Blocks Frontend] Skipping Shipping selector.");setTimeout(y,100)}function y(){const e=document.querySelectorAll(".wc-block-components-address-card .wc-block-components-address-card__edit");e.length>0&&e.forEach((e=>{e.style.display="none"}))}function g(e){const s=i.addresses||{},t=s[e]&&Object.keys(s[e]).length>0,n="yes"===i.allow_new;if(!t&&!n)return;const r=`.wp-block-woocommerce-checkout-${e}-address-block .wc-block-components-checkout-step__content`,a=document.querySelector(r);if(a){let s=a.querySelector(`.hc-wcma-${e}-mount-point`);if(s)!function(e,...s){const t=new Date,o=`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}.${String(t.getMilliseconds()).padStart(3,"0")}`;console.log(`[${o}] ${e}`,...s)}(`Mount point already exists for ${e}.`);else{s=document.createElement("div"),s.className=`hc-wcma-${e}-mount-point`;const t=a.querySelector(".wc-block-components-checkout-step__content");t?t.parentNode.insertBefore(s,t):a.prepend(s)}if(!s.dataset.reactMounted)try{(0,o.render)((0,l.jsx)(u,{addressType:e}),s),s.dataset.reactMounted="true",_(e,!1)}catch(s){console.error(`Error mounting ${e} component:`,s)}}}function _(e,s){const t=`#${e}-fields .wc-block-components-address-address-wrapper`,o=document.querySelector(t);o?s?o.classList.add("is-editing"):(o.classList.remove("is-editing"),setTimeout((()=>y()),100)):console.warn(`[HCMA Blocks ${e}] Wrapper '${t}' not found to toggle is-editing.`)}let b=null;function k(){const e=document.querySelector(".wp-block-woocommerce-checkout");e&&(b||(b=new MutationObserver((e=>{let s=!1,t=!1;for(const o of e)if("childList"===o.type&&o.addedNodes.length>0&&o.addedNodes.forEach((e=>{1===e.nodeType&&((e.matches(".wp-block-woocommerce-checkout-billing-address-block")||e.querySelector(".wp-block-woocommerce-checkout-billing-address-block"))&&(s=!0),(e.matches(".wp-block-woocommerce-checkout-shipping-address-block")||e.querySelector(".wp-block-woocommerce-checkout-shipping-address-block"))&&(t=!0))})),s&&t)break;s&&setTimeout((()=>g("billing")),150),t&&setTimeout((()=>g("shipping")),150)})),b.observe(e,{childList:!0,subtree:!0})))}document.addEventListener("DOMContentLoaded",(()=>{setTimeout(h,750),setTimeout(k,1500)}))}},t={};function o(e){var n=t[e];if(void 0!==n)return n.exports;var r=t[e]={exports:{}};return s[e](r,r.exports,o),r.exports}o.m=s,e=[],o.O=(s,t,n,r)=>{if(!t){var a=1/0;for(i=0;i<e.length;i++){for(var[t,n,r]=e[i],c=!0,d=0;d<t.length;d++)(!1&r||a>=r)&&Object.keys(o.O).every((e=>o.O[e](t[d])))?t.splice(d--,1):(c=!1,r<a&&(a=r));if(c){e.splice(i--,1);var l=n();void 0!==l&&(s=l)}}return s}r=r||0;for(var i=e.length;i>0&&e[i-1][2]>r;i--)e[i]=e[i-1];e[i]=[t,n,r]},o.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return o.d(s,{a:s}),s},o.d=(e,s)=>{for(var t in s)o.o(s,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:s[t]})},o.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),(()=>{var e={15:0,278:0};o.O.j=s=>0===e[s];var s=(s,t)=>{var n,r,[a,c,d]=t,l=0;if(a.some((s=>0!==e[s]))){for(n in c)o.o(c,n)&&(o.m[n]=c[n]);if(d)var i=d(o)}for(s&&s(t);l<a.length;l++)r=a[l],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return o.O(i)},t=globalThis.webpackChunkhappycoders_multiple_addresses=globalThis.webpackChunkhappycoders_multiple_addresses||[];t.forEach(s.bind(null,0)),t.push=s.bind(null,t.push.bind(t))})();var n=o.O(void 0,[278],(()=>o(433)));n=o.O(n)})();